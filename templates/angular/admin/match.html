<script type="text/javascript">
  angular.module('pencilblueApp')
    .controller('MatchController', function($scope, $sce, $http) {
    ^angular_objects^

    // Set default value for statistics type
    $scope.statType = "goal";

    // Regex pattern to match statistics time:
    // Minutes 1-9 | minutes from 10-89 and 90| 
    const gameTimeRegex = "^[1-9]$|^[1-8][0-9]$|^90$";
    // 1st half over time: 45 minutes + 1-9 extra time minutes |
    // 2nd half over time: 90 minutes + 1-9 extra time minutes
    const extraTimeRegex = "|^45\\+[1-9]$|^90\\+[1-9]$";
    
    // Combine to single regex
    $scope.statTimeRegex = gameTimeRegex + extraTimeRegex;

    // Add new statistics
    $scope.addStat = function() {
      const newStat = {
        "type": $scope.statType,
        "matchId": $scope.selected._id,
        "playerId": $scope.player._id,
        "playerName": $scope.player.name
      };

      // Get stat time
      $scope.getStatTime(newStat, $scope.statTime);

      console.log(newStat);

      // Send data to the server
      $http.post("/club-manager/api/stats", newStat)
      .then(
        function(response) {
          $scope.selected.stats.push(newStat);
        } 
      );
    };

    // Get statistics time
    $scope.getStatTime = function(newStat, time) {
      // Stat time is validated for time+extra minutes,
      // for example 45+2, where extra time is optional.
      const statTimes = time.split('+');
      newStat.time = Number(statTimes[0]);
      
      // Add extra time if available
      if(statTimes.length > 1) {
        newStat.extraTime = Number(statTimes[1]);
      }
    };

    // Delete existing statistic
    $scope.deleteStat = function(stat) {
      console.log(stat);
    };
  });
</script>

